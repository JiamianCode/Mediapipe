<!doctype html>
<html lang="zh">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 5 Layout Example</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/layout.css">

    <!-- Mediapipe Pose JS -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.2/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.2/pose.js" crossorigin="anonymous"></script>

    <!-- 引入 d3 文件 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- 引入 ECharts 文件和ECharts GL库 -->
    <script type="text/javascript" src="https://registry.npmmirror.com/echarts/5.4.3/files/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://registry.npmmirror.com/echarts-gl/2/files/dist/echarts-gl.min.js"></script>
</head>
<body>
<!-- 头部导航栏 -->
<nav class="navbar navbar-expand-lg navbar-light bg-navbar navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">网页标题</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <!-- 首页 -->
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">首页</a>
                </li>
                <!-- 添加Dropdown控件 -->
                <li class="nav-item dropdown">
                <li class="nav-item dropdown">
                    <!-- btn-primary是默认颜色控件，也可以自定义类名并用css实现 -->
                    <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        Image Source
                    </button>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="#">None</a></li>
                        <li><a class="dropdown-item" href="#">Camera</a></li>
                        <li><a class="dropdown-item" href="#">Local File</a></li>
                    </ul>
                </li>
                <!-- 更多的导航项 -->
            </ul>
        </div>
    </div>
</nav>

<!-- 主体部分 -->
<div class="container-fluid bg-main">
    <div class="row border">
        <!-- 控制面板 -->
        <div class="col-md-2">
            <div class="row p-2">
                <!-- 顶部的控制模块 -->
                <div class="w-100">
                    <div class="d-flex justify-content-center flex-wrap">
                        <!-- 源选择:无、摄像头、本地文件 -->
                        <!-- 移动到导航栏选择 -->
                        <!--
                        <div class="m-2">
                            <div class="mb-3">
                                <label for="imageSource" class="form-label">Image Source</label>
                                <select id="imageSource" class="form-select">
                                    <option value="none">None</option>
                                    <option value="camera">Camera</option>
                                    <option value="file">Local File</option>
                                </select>
                            </div>
                        </div>
                        -->
                        <!-- 源选择为本地文件时，文件选择 -->
                        <div class="m-2" id="fileInputContainer" style="display: none;">
                            <div class="mb-3">
                                <label for="file" class="form-label">Select File</label>
                                <input class="form-control" type="file" id="file" accept="video/*">
                                <div class="form-text" id="fileName">No file selected</div>
                            </div>
                        </div>
                        <!-- 显示内容选择:源图、处理图（多选处理效果） -->
                        <div class="m-2" id="visualizationModeContainer" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">Visualization Mode</label>
                                <div class="form-check">
                                    <input type="checkbox" id="originalImage" class="form-check-input" checked>
                                    <label class="form-check-label" for="originalImage">Original Image</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="skeleton" class="form-check-input">
                                    <label class="form-check-label" for="skeleton">Skeleton</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="hull" class="form-check-input">
                                    <label class="form-check-label" for="skeleton">Hull</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="function" class="form-check-input">
                                    <label class="form-check-label" for="skeleton">Function</label>
                                </div>
                            </div>
                        </div>
                        <!-- 图表多选 -->
                        <div class="m-2" id="chartSelectionContainer" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">Data Chart Options</label>
                                <div class="form-check">
                                    <input type="checkbox" id="checkboxChart1" class="form-check-input">
                                    <label class="form-check-label" for="checkboxChart1">Chart 1</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="checkboxChart2" class="form-check-input">
                                    <label class="form-check-label" for="checkboxChart2">Chart 2</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 显示画面 -->
        <div class="col-md-5 p-2">
            <div class="row border h-100"><!-- h-100表示占满高度 -->
                <div class="col-md-8 bg-output-canvas p-2">
                    <!-- 主画面 -->
                    <div class="video-container" id="videoContainer" style="display: none;">
                        <canvas id="outputCanvas"></canvas>
                    </div>
                </div>
                <div class="col-md-4 p-2">
                    <div class="row g-3">
                        <div class="col-md-12">
                            <div class="bg-input-video" id="inputVideoContainer">
                                <!-- 原画面 -->
                                <video id="inputVideo" autoplay muted playsinline></video>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div id="skeletonContainer">
                                <!-- 骨骼动画 -->
                                <div id="skeleton3D"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表区 -->
        <div class="col-md-5 p-2">
            <div class="row g-2">
                <!-- 第一行 -->
                <div class="col-md-4">
                    <div class="bg-chart-1 h-100" id="firstChartContainer">
                        <div id="containerChart2" class="chart-container">
                            <svg width="400" height="200" id="chart2"></svg>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="bg-chart-2 h-100">
                        <div id="containerChart3" class="chart-container">
                            <svg width="400" height="200" id="chart3"></svg>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="bg-chart-3 h-100">
                        <div id="containerChart4" class="chart-container">
                            <svg width="400" height="200" id="chart4"></svg>
                        </div>
                    </div>
                </div>

                <!-- 第二行 -->
                <div class="col-md-12 h-100">
                    <div class="p-3 bg-chart-4 h-100">
                        <div id="containerChart5" class="chart-container">
                            <svg width="400" height="200" id="chart5"></svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 底部内容 -->
<div class="container-fluid bg-bottom">
    <div class="row border p-2">
        <div class="row gx-2">
            <div class="col-md-4">
                <div class="p-3 bg-chart-5 h-100">
                    <div id="chartContainer" style="display: none;">
                        <div id="containerChart1" class="chart-container">
                            <svg width="400" height="200" id="chart1"></svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="p-3 bg-text h-100">提示文本</div>
            </div>
            <div class="col-md-3">
                <div class="p-3" id="poseCanvasContainer">
                    <!-- 按压示意图 -->
                    <canvas id="poseCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script type="text/javascript" src="js/pose.js"></script>
<script type="text/javascript" src="js/inputImage.js"></script>
<script type="text/javascript" src="js/outputImage.js"></script>
<script type="text/javascript" src="js/landmarkTrack.js"></script>
<script type="text/javascript" src="js/landmarkAngle.js"></script>
<script type="text/javascript" src="js/collideForce.js"></script>
<script type="text/javascript" src="js/skeleton.js"></script>
<script type="text/javascript" src="js/control.js"></script>
<script>
    // JavaScript代码
    document.querySelectorAll('.dropdown-menu .dropdown-item').forEach(item => {
        item.addEventListener('click', function() {
            updateDropdownButton(this.textContent);
        });
    });

    function updateDropdownButton(selectedItemText) {
        // 更新按钮文本
        document.querySelector('.dropdown-toggle').textContent = "Image Source : " + selectedItemText;

        // console.log("选中的操作是：" + selectedItemText);

        // 最初隐藏所有容器
        // resetUI();
        fileInputContainer.style.display = 'none';
        visualizationModeContainer.style.display = 'none';
        chartSelectionContainer.style.display = 'none';
        videoContainer.style.display = 'none';
        chartContainer.style.display = 'none';
        inputVideo.src = '';
        outputCanvas.getContext('2d').clearRect(0, 0, outputCanvas.width, outputCanvas.height);


        // 根据选择进行操作
        switch (selectedItemText){
            case 'None':// 如果选择了"None"，刷新页面重新开始
                window.location.reload();
                break;
            case 'Camera':// 如果选择了"Camera"，显示可视化模式和图表选择
                visualizationModeContainer.style.display = '';
                chartSelectionContainer.style.display = '';
                videoContainer.style.display = '';
                console.log("camera input");

                //originalImage.checked = true;
                checkCameraStatus();
                break;
            case 'Local File':// 如果选择了"Local File"，最初只显示文件输入容器
                fileInputContainer.style.display = '';
                console.log("file input")
                // 文件被选择后，添加change事件监听器以显示可视化模式和图表选择
                fileInput.onchange = () => {
                    if (fileInput.files.length > 0) {
                        visualizationModeContainer.style.display = '';
                        chartSelectionContainer.style.display = '';
                        videoContainer.style.display = '';
                        console.log("file selected");

                        //originalImage.checked = true;
                    }
                };
                break;
            default:
                console.log("选中的操作是：" + selectedItemText);
        }
    }

</script>
</body>
</html>
